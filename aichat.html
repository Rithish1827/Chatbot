<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat Bot</title>
    <link rel="stylesheet" href="aichat.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: linear-gradient(135deg, #021430 0%, #08345f 100%);
            font-family: 'Segoe UI', 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
        }
        nav {
            background: #05243b;
            padding: 1em 2em;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 12px rgba(11, 61, 145, 0.08);
        }
        .ai-title-nav {
            font-size: 1.5em;
            font-weight: 900;
            letter-spacing: 0.08em;
            color: #ffffff;
        }
        .nav-links {
            display: flex;
            align-items: center;
        }
        .nav-links a {
            color: #ffffff;
            text-decoration: none;
            margin-left: 2em;
            font-size: 1.1em;
            font-weight: 500;
            position: relative;
            transition: color 0.3s;
        }
        .nav-links a::after {
            content: "";
            display: block;
            width: 0;
            height: 2px;
            background: #ffffff;
            transition: width 0.3s;
            position: absolute;
            left: 0;
            bottom: -4px;
            border-radius: 2px;
        }
        .nav-links a:hover::after {
            width: 100%;
        }
        .nav-links a:hover {
            filter: brightness(1.2);
        }
        /* Chat layout is now controlled by aichat.css (WhatsApp-like styles) */
        .quick-replies {
            display: flex;
            gap: 0.5em;
            flex-wrap: wrap;
            margin: 0.5em 0;
        }
    </style>
</head>
<body>
    <nav>
        <div class="ai-title-nav">AI Chat Bot</div>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="aichat.html">AI Chat</a>
        </div>
    </nav>
    <div class="app-grid">

      <aside class="chat-list">
        <h2>Chats</h2>
        <ul class="chats">
          <li class="chat-item active" data-chat="rithish">
            <div class="name">Rithish</div>
            <div class="meta">Hey there!</div>
          </li>
          <li class="chat-item" data-chat="austin">
            <div class="name">Austin</div>
            <div class="meta typing">Typing...</div>
          </li>
          <li class="chat-item" data-chat="group1">
            <div class="name">Study Group</div>
            <div class="meta">3 new messages</div>
          </li>
        </ul>
      </aside>

      <section class="chat-panel">
        <header class="panel-header">
          <div>
            <div class="panel-title" id="chatTitle">Rithish</div>
            <div class="panel-status" id="chatStatus">Online</div>
          </div>
        </header>

        <main class="panel-main">
          <ul id="messages" class="messages" aria-live="polite"></ul>
        </main>

        <div class="quick-replies" style="padding: 10px 18px;">
          <button class="quick-btn" onclick="useQuickReply('Hi')">Hi</button>
          <button class="quick-btn" onclick="useQuickReply('Help')">Help</button>
          <button class="quick-btn" onclick="useQuickReply('What is your name?')">What's your name?</button>
          <button class="quick-btn" onclick="useQuickReply('Thanks')">Thanks</button>
        </div>

        <footer class="panel-input">
          <input type="text" id="userInput" placeholder="Type a message..." onkeydown="if(event.key==='Enter'){sendMessage();}">
          <button id="sendBtn" class="send">Send</button>
        </footer>
      </section>
    </div>
    <script>
        const conversations = {
            rithish: {
                id: 'rithish', name: 'Rithish', status: 'Online', messages: [
                    { sender: 'alice', text: 'Hi! How are you?' },
                    { sender: 'you', text: "I'm good! Working on my project ðŸ˜„" },
                    { sender: 'alice', text: 'Nice! Keep going ðŸ’ª' }
                ]
            },
            austin: {
                id: 'austin', name: 'RITHISH', status: 'Typing...', messages: [
                    { sender: 'RITHSH', text: '...typing...' }
                ]
            },
            group1: {
                id: 'group1', name: 'Study Group', status: '3 members', messages: [
                    { sender: 'bob', text: 'Can we meet tomorrow?' },
                    { sender: 'carol', text: 'Sure, works for me.' }
                ]
            }
        };

        const participants = [
            { id: 'you', name: 'You', initials: 'Me', color: '#bfeeb5' },
            { id: 'alice', name: 'Alice', initials: 'AL', color: '#f7a78a' },
            { id: 'bob', name: 'Bob', initials: 'BO', color: '#a8e6a2' },
            { id: 'carol', name: 'Carol', initials: 'CA', color: '#ffd86b' },
            { id: 'assistant', name: 'Assistant', initials: 'AI', color: '#a8d1ff' }
        ];

        let currentChat = 'rithish';

        function renderChatList() {
            document.querySelectorAll('.chat-item').forEach(item => {
                item.addEventListener('click', () => {
                    const id = item.dataset.chat;
                    selectChat(id);
                });
            });
        }

        function selectChat(id) {
            if (!conversations[id]) return;
            currentChat = id;
            document.querySelectorAll('.chat-item').forEach(i => i.classList.toggle('active', i.dataset.chat === id));
            document.getElementById('chatTitle').textContent = conversations[id].name;
            document.getElementById('chatStatus').textContent = conversations[id].status;
            renderConversation(id);
        }

        function renderConversation(id) {
            const msgs = document.getElementById('messages');
            msgs.innerHTML = '';
            const conv = conversations[id];
            conv.messages.forEach(m => addMessage(m.text, m.sender, {save:false}));
        }

        function addMessage(text, senderId='assistant', opts={save:true}) {
            const messages = document.getElementById('messages');
            const li = document.createElement('li');
            const participant = participants.find(p => p.id === senderId) || { name: senderId, initials: senderId.slice(0,2), color:'#ddd' };
            const isMe = senderId === 'you';
            li.className = 'message ' + (isMe ? 'user' : 'bot');

            if (!isMe) {
                const avatar = document.createElement('div');
                avatar.className = 'avatar small';
                avatar.textContent = participant.initials;
                avatar.style.background = participant.color;
                li.appendChild(avatar);
            }

            const content = document.createElement('div');
            content.className = 'content';

            if (!isMe) {
                const name = document.createElement('div');
                name.className = 'sender-name';
                name.textContent = participant.name;
                content.appendChild(name);
            }

            const bubble = document.createElement('div');
            bubble.className = 'bubble';
            bubble.innerHTML = escapeHtml(text);
            content.appendChild(bubble);

            const meta = document.createElement('div');
            meta.className = 'meta';
            const time = document.createElement('span');
            time.className = 'time';
            time.textContent = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
            meta.appendChild(time);
            content.appendChild(meta);

            li.appendChild(content);
            messages.appendChild(li);
            messages.scrollTop = messages.scrollHeight;

            if (opts.save !== false) {
                // save to conversation
                conversations[currentChat].messages.push({ sender: senderId, text });
            }
        }

        async function sendMessage(fromQuick=false, quickText='') {
            const inputElem = document.getElementById('userInput');
            const input = fromQuick ? quickText : (inputElem ? inputElem.value.trim() : '');
            if (!input) return;

            // display as current user
            addMessage(input, 'you');
            if (inputElem) inputElem.value = '';

            // local canned replies attributed to assistant
            const local = getLocalReply(input);
            if (local !== null) {
                setTimeout(()=> addMessage(local, 'assistant'), 400);
                return;
            }

            try {
                let response = await fetch("http://localhost:5000/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ message: input, chat: currentChat })
                });
                let data = await response.json();
                addMessage(data.reply || "Sorry, I didn't get a reply.", 'assistant');
            } catch (err) {
                addMessage("Sorry, I couldn't connect to the server.", 'assistant');
            }
        }

        function getLocalReply(text) {
            const t = text.toLowerCase().trim();
            if (/^(hi|hello|hey)\b/.test(t)) return "Hello! I'm your AI assistant. Ask me anything or try 'Help' for suggestions.";
            if (t.includes('help')) return "I can chat here and answer simple questions. Try: 'What's your name?', 'What can you do?', 'Time', or 'Thanks'.";
            if (t.includes('your name') || t.includes('who are you')) return "I'm the AI Chat Bot â€” a small prototype. I can answer basic questions or forward messages to the server.";
            if (t.includes('what can you do')) return "I can answer simple questions, give suggestions, and forward complex requests to a server-based AI if available.";
            if (t.includes('thank')) return "You're welcome! Happy to help ðŸ˜Š";
            if (t.includes('time')) return "I don't have access to the system clock here, but you can check your device's time.";
            if (t.includes('bye') || t.includes('goodbye')) return "Goodbye! Feel free to come back anytime.";
            return null;
        }

        function useQuickReply(text) {
            const sel = document.getElementById('senderSelect');
            // keep the selected sender
            sendMessage(true, text);
        }
        function escapeHtml(text) {
            let div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        document.addEventListener('DOMContentLoaded', ()=>{
            renderChatList();
            selectChat(currentChat);
            const sendBtn = document.getElementById('sendBtn'); if (sendBtn) sendBtn.addEventListener('click', sendMessage);
        });
    </script>
</body>
</html>